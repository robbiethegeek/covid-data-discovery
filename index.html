<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>COVID-19 Data Discovery</title>
  <meta name="description" content="COVID-19 Data Discovery">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script type="text/javascript" src="index.js"></script>

  <!-- <link rel="manifest" href="site.webmanifest"> -->
  <!-- <link rel="apple-touch-icon" href="icon.png"> -->
  <!-- Place favicon.ico in the root directory -->

  <!-- <link rel="stylesheet" href="css/normalize.css"> -->
  <!-- <link rel="stylesheet" href="css/main.css"> -->

  <!-- <meta name="theme-color" content="#fafafa"> -->
</head>

<style>
  .sticky {
    position: -webkit-sticky; 
    position: sticky; 
    top: 0px;
    /* border-bottom: 1px solid black; */
    background-color: white;
    margin: auto;
    /* text-align-last: justify; */
    height: fit-content;
    z-index: 999;
  }
  nav {
    position: -webkit-sticky; 
    position: sticky; 
    top: 0px;
    /* border-bottom: 1px solid black; */
    background-color: white;
    margin: auto;
    /* text-align-last: justify; */
    height: fit-content;
    z-index: 999;
  }
  nav > ul {
    list-style-type: none;
    padding: 0.1em;
    margin: auto;
    text-align-last: justify;
  }
  nav li {
    padding: 0 0 0 0.2em;
    display: inline-block;
  }
  body {
    font-family: serif;
    position: relative;
  }
  form {
    /* width: 100%; */
  }
  select {
    /* width: 100%; */
  }
  fieldset.metrics {
    margin: auto;
    text-align-last: justify;
    height: fit-content;
  }
  fieldset.metrics div {
    display: inline-block;
  }
  label.metric-checkbox {
    line-height: 2em;
    padding: 0.5em;
    background-color: white;
    border: 1px solid black;
    border-radius: 0.5em;
    cursor: pointer;
  }
  label.metric-checkbox.selected {
    color: white;
    font-weight: bold;
    background-color: black;
  }
  fieldset.metrics label > input {
    display: none;
  }
  #plot {
    height: 100vh;
    font-family: serif;
  }
  .table {
    margin: 1em;
    height: fit-content;
    /* overflow-x: scroll; */
  }
  table {
    table-layout: auto;
    border-collapse: collapse;
    border: 1px solid black;
  }
  th, td, tr {
    border: 1px solid black;
  }
  div.open-an-issue {
    position: -webkit-sticky;
    position: sticky;
    bottom: 0px;
    right: 0px
  }
</style>

<!-- var height = Math.max( document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight ); -->
<body>
  <a href="top"></a>
  <div class="sticky">
    <nav class="header">
      <ul>
        <li><a href="#top">Jump to top</a></li>
        <li><a href="https://github.com/trycrmr/covid-data-discovery/blob/master/README.md" target="_blank" rel="noreferrer noopener" alt="Learn more about this project by reading the README on the Github repo">About</a></li>
        <li><a href="https://github.com/trycrmr/covid-data-discovery/issues" target="_blank" rel="noreferrer noopener" alt="Contact by opening an issue on Github.">Contact (Open an issue)</a></li>
        <li><a href="https://github.com/trycrmr/covid-data-discovery/issues" target="_blank" rel="noreferrer noopener" alt="Report an issue on Github.">Report an issue.</a></li>
      </ul>
    </nav>
    <form class="fitler-form">
      <fieldset>
        <legend>Choose a region</legend>
        <select name="filter-regions" style="width: 100%;">
          <option value="Global">Global</option>
          <option value="Africa">Africa</option>
          <option value="Australia">Australia</option>
          <option value="Canada">Canada</option>
          <option value="China">China</option>
          <option value="Europe">Europe</option>
          <option value="LatinAmerica">Latin America</option>
          <option value="USA">USA</option>
        </select>
      </fieldset>
      <fieldset class="metrics">
        <legend>Choose a few metrics</legend>
        <div>
          <label class="metric-checkbox selected">Cases
            <input type="checkbox" value="cases" name="cases" checked>
          </label>
        </div>
        <div>
          <label class="metric-checkbox">Recovered
            <input type="checkbox" value="recovered" name="recovered">
          </label>
        </div>
        <div>
          <label class="metric-checkbox">Critical
            <input type="checkbox" value="critical" name="critical">
          </label>
        </div>
        <div>
          <label class="metric-checkbox">Deaths
            <input type="checkbox" value="deaths" name="deaths">
          </label>
        </div>
      </fieldset>
    </form>
  </div>
    <div id='plot'></div>
    <div class='table'></div>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
</body>
<script>
document.addEventListener("DOMContentLoaded", async(event) => {
  const getData = async(url, config) => {
    try {
      const data = await fetch(url, config)
      const jsonData = await data.json()
      return jsonData
    } catch (err) {
      console.error(err)
    }
  }

  const thisData = await getData('http://localhost:3000/api', {
    method: 'GET', // *GET, POST, PUT, DELETE, etc.
    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
    headers: {
      'Content-Type': 'application/json'
    },
  })
  const app = new (init(thisData)) // returns App
  app.updateState({ listeners: [...app.state.listeners, ...[ () => app.updatePlot('plot') ]] } )
  
  document.querySelector('select[name=filter-regions]').addEventListener('change', (event) => app.setFilters('region', event.target.value))
  document.querySelectorAll('.metric-checkbox').forEach(thisNode => thisNode.addEventListener('click', (event) => {
    if(!event.target.value) return undefined
    if(event.target.checked && !(app.state.filters.metric.includes(event.target.value))) {
      event.target.labels.forEach(thisLabel => thisLabel.classList.toggle('selected'))
      app.setFilters('metric', [ ...app.state.filters.metric, event.target.value ])
    } else if(!event.target.checked && app.state.filters.metric.length > 1) {
      event.target.labels.forEach(thisLabel => thisLabel.classList.toggle('selected'))
      app.setFilters('metric', app.state.filters.metric.filter( metric => metric !== event.target.value ))
    } else {
      return undefined
    }
  }))

});
</script>

</html>
